import{_ as d,r as o,o as Q,c as s,d as a,a as n,w as e,e as t,b as T}from"./app.16e13bb9.js";const I1=JSON.parse('{"title":"SLUB计算order","description":"","frontmatter":{},"headers":[{"level":2,"title":"1. 简介","slug":"_1-简介","link":"#_1-简介","children":[]},{"level":2,"title":"2. 基本思想","slug":"_2-基本思想","link":"#_2-基本思想","children":[]},{"level":2,"title":"3. order的影响因素","slug":"_3-order的影响因素","link":"#_3-order的影响因素","children":[]},{"level":2,"title":"4. order的计算过程","slug":"_4-order的计算过程","link":"#_4-order的计算过程","children":[]},{"level":2,"title":"4. 小结","slug":"_4-小结","link":"#_4-小结","children":[]}],"relativePath":"linux/memory/slub/slub_order/slub_order.md"}'),i={name:"linux/memory/slub/slub_order/slub_order.md"},m=T("",6),c={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},h={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"29.472ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 13026.6 1000","aria-hidden":"true"},F=T("",1),y=[F],g=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[a("mi",null,"o"),a("mi",null,"b"),a("mi",null,"j"),a("mi",null,"e"),a("mi",null,"c"),a("mi",null,"t"),a("mi",null,"s"),a("mo",null,"="),a("mi",null,"o"),a("mi",null,"o"),a("mi",{mathvariant:"normal"},"&"),a("mo",{stretchy:"false"},"("),a("mo",{stretchy:"false"},"("),a("mn",null,"1"),a("mo",null,"<<"),a("mn",null,"16"),a("mo",{stretchy:"false"},")"),a("mo",null,"−"),a("mn",null,"1"),a("mo",{stretchy:"false"},")")],-1),u={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},_={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.464ex"},xmlns:"http://www.w3.org/2000/svg",width:"23.639ex",height:"2.508ex",role:"img",focusable:"false",viewBox:"0 -903.7 10448.3 1108.7","aria-hidden":"true"},H=T("",1),w=[H],f=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[a("mi",null,"p"),a("mi",null,"a"),a("mi",null,"g"),a("mi",null,"e"),a("mi",null,"s"),a("mo",null,"="),a("msup",null,[a("mn",null,"2"),a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",null,"o"),a("mi",null,"r"),a("mi",null,"d"),a("mi",null,"e"),a("mi",null,"r")])]),a("mo",null,"="),a("msup",null,[a("mn",null,"2"),a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",null,"o"),a("mi",null,"o"),a("mo",null,">>"),a("mn",null,"16")])])],-1),b=a("h2",{id:"_2-基本思想",tabindex:"-1"},[t("2. 基本思想 "),a("a",{class:"header-anchor",href:"#_2-基本思想","aria-hidden":"true"},"#")],-1),L=a("p",null,[t("一个"),a("code",null,"slab"),t("的大小可以是一页内存，也可以二页内存到底由几页内存组成一个slab，这是通过一个算法来计算的，算法核心思想如下：")],-1),M=a("li",null,[t("order的大小会影响系统性能和系统中的其他组件的工作，比如伙伴系统和内存回收机制。一般情况"),a("code",null,"order=0"),t("应该是最好的情况，因为这样引起内存的外部碎片的可能性更小。但是一个比较大的order,可以减少slab在cpu partial表和node partial表的移动，从而提高分配效率，因为这样可以减少持锁的机率。")],-1),k={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},x={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.816ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.595ex",height:"2.773ex",role:"img",focusable:"false",viewBox:"0 -864.9 1147.1 1225.5","aria-hidden":"true"},Z=T("",1),V=[Z],D=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mfrac",null,[a("mn",null,"1"),a("mn",null,"16")])],-1),v=a("li",null,"要尽量让一个slab上的object多，不然会引更多的slab在cpu和node的partial上移动。",-1),E=a("li",null,"如果计算出来的order大于最大的order,也就是slub_max_order，那么就考虑接受浪费更多的空间和减低slab上的object数量",-1),A=a("h2",{id:"_3-order的影响因素",tabindex:"-1"},[t("3. order的影响因素 "),a("a",{class:"header-anchor",href:"#_3-order的影响因素","aria-hidden":"true"},"#")],-1),C=T("",4),j={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.108ex"},xmlns:"http://www.w3.org/2000/svg",width:"18.12ex",height:"3.065ex",role:"img",focusable:"false",viewBox:"0 -864.9 8008.9 1354.9","aria-hidden":"true"},P=T("",1),z=[P],I=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mi",null,"s"),a("mi",null,"l"),a("mi",null,"a"),a("mi",null,"b"),a("mi",{mathvariant:"normal"},"_"),a("mi",null,"s"),a("mi",null,"i"),a("mi",null,"z"),a("mi",null,"e"),a("mo",null,"∗"),a("mfrac",null,[a("mn",null,"1"),a("mrow",null,[a("mi",null,"f"),a("mi",null,"r"),a("mi",null,"a"),a("mi",null,"c"),a("mi",null,"t"),a("mi",null,"i"),a("mi",null,"o"),a("mi",null,"n")])])],-1),R=T("",6),B={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},N={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"39.92ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 17644.4 1000","aria-hidden":"true"},O=T("",1),G=[O],J=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[a("mi",null,"m"),a("mi",null,"i"),a("mi",null,"n"),a("mi",{mathvariant:"normal"},"_"),a("mi",null,"o"),a("mi",null,"b"),a("mi",null,"j"),a("mi",null,"e"),a("mi",null,"c"),a("mi",null,"t"),a("mi",null,"s"),a("mo",null,"="),a("mn",null,"4"),a("mo",null,"∗"),a("mo",{stretchy:"false"},"("),a("mi",null,"f"),a("mi",null,"l"),a("mi",null,"s"),a("mo",{stretchy:"false"},"("),a("mi",null,"n"),a("mi",null,"r"),a("mi",{mathvariant:"normal"},"_"),a("mi",null,"c"),a("mi",null,"p"),a("mi",null,"u"),a("mi",{mathvariant:"normal"},"_"),a("mi",null,"i"),a("mi",null,"d"),a("mi",null,"s"),a("mo",{stretchy:"false"},")"),a("mo",null,"+"),a("mn",null,"1"),a("mo",{stretchy:"false"},")")],-1),X=a("p",null,"其中fls函数就是返回一个整数的最后一个为1的bit所在的位置。如1返回的就是1,8返回的就是4.",-1),$=a("li",null,[a("p",null,[t("代码18～19行： 确保"),a("code",null,"min_object"),t("需要的页面数order不超过最大的order.")])],-1),Y=a("code",null,"min_objects",-1),U={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},q={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.816ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.069ex",height:"2.773ex",role:"img",focusable:"false",viewBox:"0 -864.9 4892.3 1225.5","aria-hidden":"true"},W=T("",1),K=[W],a1=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mo",null,"<"),a("mfrac",null,[a("mn",null,"1"),a("mn",null,"16")]),a("mo",null,"∗"),a("mi",null,"s"),a("mi",null,"i"),a("mi",null,"z"),a("mi",null,"e")],-1),t1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},T1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.816ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.88ex",height:"2.773ex",role:"img",focusable:"false",viewBox:"0 -864.9 3483 1225.5","aria-hidden":"true"},Q1=T("",1),s1=[Q1],n1=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mfrac",null,[a("mn",null,"1"),a("mn",null,"8")]),a("mo",null,"∗"),a("mi",null,"s"),a("mi",null,"i"),a("mi",null,"z"),a("mi",null,"e")],-1),l1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},e1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.88ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 3483 1209.9","aria-hidden":"true"},o1=T("",1),r1=[o1],p1=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mfrac",null,[a("mn",null,"1"),a("mn",null,"4")]),a("mo",null,"∗"),a("mi",null,"s"),a("mi",null,"i"),a("mi",null,"z"),a("mi",null,"e")],-1),d1=a("code",null,"order < lsub_max_order",-1),i1=a("code",null,"min_objects",-1),m1=a("p",null,[t("代码62行： 这里的get_order，就是获取满足"),a("code",null,"min_objects"),t("和"),a("code",null,"size"),t("的最小order,如下所示：")],-1),c1={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},h1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"48.977ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 21648 1000","aria-hidden":"true"},F1=T("",1),y1=[F1],g1=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[a("mi",null,"o"),a("mi",null,"r"),a("mi",null,"d"),a("mi",null,"e"),a("mi",null,"r"),a("mo",null,"="),a("mi",null,"f"),a("mi",null,"l"),a("mi",null,"s"),a("mn",null,"64"),a("mo",{stretchy:"false"},"("),a("mo",{stretchy:"false"},"("),a("mo",{stretchy:"false"},"("),a("mo",{stretchy:"false"},"("),a("mi",null,"m"),a("mi",null,"i"),a("mi",null,"n"),a("mi",{mathvariant:"normal"},"_"),a("mi",null,"o"),a("mi",null,"b"),a("mi",null,"j"),a("mi",null,"e"),a("mi",null,"c"),a("mi",null,"t"),a("mi",null,"s"),a("mo",null,"∗"),a("mi",null,"s"),a("mi",null,"i"),a("mi",null,"z"),a("mi",null,"e"),a("mo",{stretchy:"false"},")"),a("mo",null,"−"),a("mn",null,"1"),a("mo",{stretchy:"false"},")"),a("mo",null,">>"),a("mn",null,"12"),a("mo",{stretchy:"false"},")")],-1),u1=a("p",null,"代码68行： 计算浪费的空间。",-1),_1={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},H1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"21.893ex",height:"1.882ex",role:"img",focusable:"false",viewBox:"0 -750 9676.6 832","aria-hidden":"true"},w1=T("",1),f1=[w1],b1=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[a("mi",null,"r"),a("mi",null,"e"),a("mi",null,"m"),a("mo",null,"="),a("mi",null,"s"),a("mi",null,"l"),a("mi",null,"a"),a("mi",null,"b"),a("mi",{mathvariant:"normal"},"_"),a("mi",null,"s"),a("mi",null,"i"),a("mi",null,"z"),a("mi",null,"e"),a("mi",{mathvariant:"normal"},"%"),a("mi",null,"s"),a("mi",null,"i"),a("mi",null,"z"),a("mi",null,"e")],-1),L1=a("p",null,"代码70行： 允许的浪费空间如下",-1),M1={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},k1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.016ex"},xmlns:"http://www.w3.org/2000/svg",width:"30.092ex",height:"5.115ex",role:"img",focusable:"false",viewBox:"0 -1370 13300.6 2261","aria-hidden":"true"},x1=T("",1),Z1=[x1],V1=a("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[a("mi",null,"a"),a("mi",null,"l"),a("mi",null,"l"),a("mi",null,"o"),a("mi",null,"w"),a("mi",null,"d"),a("mi",{mathvariant:"normal"},"_"),a("mi",null,"r"),a("mi",null,"e"),a("mi",null,"m"),a("mo",null,"="),a("mfrac",null,[a("mrow",null,[a("mi",null,"s"),a("mi",null,"l"),a("mi",null,"a"),a("mi",null,"b"),a("mi",{mathvariant:"normal"},"_"),a("mi",null,"s"),a("mi",null,"i"),a("mi",null,"z"),a("mi",null,"e")]),a("mrow",null,[a("mi",null,"f"),a("mi",null,"r"),a("mi",null,"a"),a("mi",null,"c"),a("mi",null,"t"),a("mi",{mathvariant:"normal"},"_"),a("mi",null,"l"),a("mi",null,"e"),a("mi",null,"f"),a("mi",null,"t"),a("mi",null,"o"),a("mi",null,"v"),a("mi",null,"e"),a("mi",null,"r")])])],-1),D1=a("p",null,"然后比较rem是不是小于allowd_rem.",-1),v1=T("",5);function E1(r,A1,C1,j1,S1,P1){const l=o("mjx-assistive-mml"),p=o("Vssue");return Q(),s("div",null,[m,a("mjx-container",c,[(Q(),s("svg",h,y)),n(l,{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},{default:e(()=>[g]),_:1})]),a("mjx-container",u,[(Q(),s("svg",_,w)),n(l,{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},{default:e(()=>[f]),_:1})]),b,L,a("ol",null,[M,a("li",null,[t("应该尽可能的减少未使用的内存区域(浪费区域)，如果未使用达到整个slab大小的"),a("mjx-container",k,[(Q(),s("svg",x,V)),n(l,{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},{default:e(()=>[D]),_:1})]),t(",就应该尝试使用更大的order来避免,也就减少内部碎片。")]),v,E]),A,a("ul",null,[C,a("li",null,[a("p",null,[t("fraction 这个是允许浪费的内存大小，为"),a("mjx-container",j,[(Q(),s("svg",S,z)),n(l,{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},{default:e(()=>[I]),_:1})])])])]),R,a("mjx-container",B,[(Q(),s("svg",N,G)),n(l,{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},{default:e(()=>[J]),_:1})]),X,a("ul",null,[$,a("li",null,[a("p",null,[t("代码21~33行： 这个就是求order的过程，基本的算法就是先保持"),Y,t("不变，然后加大对浪费空间的容忍程度，就是先看能不能计算出一个order，浪费的空间"),a("mjx-container",U,[(Q(),s("svg",q,K)),n(l,{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},{default:e(()=>[a1]),_:1})]),t(",如果不行，再看"),a("mjx-container",t1,[(Q(),s("svg",T1,s1)),n(l,{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},{default:e(()=>[n1]),_:1})]),t("能否满足，最后一直到"),a("mjx-container",l1,[(Q(),s("svg",e1,r1)),n(l,{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},{default:e(()=>[p1]),_:1})]),t(",同时还要满足"),d1,t("如果还是不能满足就，就减低"),i1,t(",再重复上面的过程。直到计算出来一个order.")])]),a("li",null,[m1,a("mjx-container",c1,[(Q(),s("svg",h1,y1)),n(l,{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},{default:e(()=>[g1]),_:1})])]),a("li",null,[u1,a("mjx-container",_1,[(Q(),s("svg",H1,f1)),n(l,{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},{default:e(()=>[b1]),_:1})])]),a("li",null,[L1,a("mjx-container",M1,[(Q(),s("svg",k1,Z1)),n(l,{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},{default:e(()=>[V1]),_:1})]),D1])]),v1,n(p,{title:r.$title},null,8,["title"])])}const R1=d(i,[["render",E1]]);export{I1 as __pageData,R1 as default};
